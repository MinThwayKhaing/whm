<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	template="/common/commonLayout.xhtml">

	<ui:param name="leftMenu" value="/common/adminLeft.xhtml" />
	<ui:param name="rendered" value="true" />
	<ui:define name="content">
		<h:body>
			<h:outputStylesheet library="css" name="deleteStyle.css"></h:outputStylesheet>
			<h:form id="weeklyReportEntryForm" styleClass="form-horizontal"
				style="margin-bottom: 1px;">
				<table class="whmPageStatus">
					<tr>
						<td><h:outputText value="Daily Report Registration Status(Individual)"
								style="padding:7px;" /></td>
					</tr>
				</table>
				<table width="100%">
					<tr>
						<td></td>
						<td width="70%" align="center">
							<div
								style="z-index: 100; position: fixed; margin-top: -30px; width: 700px;">
								<p:messages showDetail="true" id="messages" closable="true" />
							</div>
						</td>
					</tr>
				</table>

				<table class="whmBackStyle">

					<tr>
						<td colspan="2"><span class="cmms-label"><h:outputText
									value="Staff ID" /><span style="color: red">*</span></span></td>
						<td>:</td>
						<td><p:message id="staffIDMsg" for="staffID" /> <p:inputText
								id="staffID"
								value="#{DailyReportRegistrationStatusIndividualBean.dailyReport.staffID.username}"
								style="width:146px;" maxlength="15"
								disabled="#{sessionScope.loginUser.authorities.size() == 0 and sessionScope.loginUser.role != 'ADMIN' and  sessionScope.loginUser.role != 'MANAGEMENT'}">
								<p:ajax
									listener="#{DailyReportRegistrationStatusIndividualBean.staffIdSelect}"
									update="staffName Year Month messages showBtn" event="blur" />
							</p:inputText></td>
						<td colspan="2"></td>
						<td width="120px;"><span class="cmms-label">Staff Name
						</span></td>
						<td>:</td>
						<td><h:outputText id="staffName"
								value="#{DailyReportRegistrationStatusIndividualBean.dailyReport.staffID.fullName}" /></td>

						<td></td>
						<td></td>
						<td></td>
						<td></td>

					</tr>



					<tr>
						<td colspan="2"><span class="cmms-label">Year</span><span
							style="color: red">*</span></td>
						<td>:</td>
						<td><p:message id="YearMsg" for="Year" /> <p:selectOneMenu
								id="Year"
								value="#{DailyReportRegistrationStatusIndividualBean.year}"
								style="width:120px;">
								<!-- <f:selectItems itemLabel="-" itemValue="#{null}" /> -->
								<f:selectItems
									value="#{DailyReportRegistrationStatusIndividualBean.years}" />
							</p:selectOneMenu></td>




						<td colspan="2"></td>
						<td width="120px;"><span class="cmms-label">Month</span><span
							style="color: red">*</span></td>
						<td>:</td>
						<td><p:message id="MonthMsg" for="Month" /> <p:selectOneMenu
								id="Month"
								value="#{DailyReportRegistrationStatusIndividualBean.month}"
								style="width:120px;">
								<!-- <f:selectItems itemLabel="-" itemValue="#{null}" /> -->
								<f:selectItems
									value="#{DailyReportRegistrationStatusIndividualBean.months}" />
							</p:selectOneMenu></td>
					</tr>

					<tr>
						<td colspan="6"></td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
					</tr>
					<tr>
						<td colspan="2"></td>
						<td></td>

						<td align="left"><p:commandButton value="Show" id="showBtn"
								enabled="#{DailyReportRegistrationStatusIndividualBean.btnControl}"
								action="#{DailyReportRegistrationStatusIndividualBean.show}"
								update=":weeklyReportEntryForm :weeklyReportTableForm" /></td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>

					</tr>
				</table>
				<br />
				<p:separator style="height:5px;margin-top: 2px;margin-bottom: 2px;" />
			</h:form>
			<h:form id="weeklyReportTableForm" widgetVar="vtWidget">

				<div class="workingHoruManagemntTeamTable">
					<p:panelGrid id="weeklyActivityTbl" style="width: 100%;">
						<f:facet name="header">

							<p:row>
								<p:column>Staff ID</p:column>
								<p:column>Staff Name</p:column>
								<p:column>Date</p:column>
								<p:column>Registration Finished</p:column>
								<p:column>Project ID</p:column>
								<p:column>Project Name</p:column>
								<p:column>Hour</p:column>

							</p:row>

						</f:facet>

						<ui:repeat var="userInfo"
							value="#{DailyReportRegistrationStatusIndividualBean.userInfoList}">
							<p:row>
								<p:column
									rowspan="#{(userInfo.day_count + userInfo.activities_count) +1 }">
									<h:outputText value="#{userInfo.username}" />
								</p:column>
								<p:column
									rowspan="#{(userInfo.day_count + userInfo.activities_count) +1 }">
									<h:outputText value="#{userInfo.fullname}" />
								</p:column>
							</p:row>
						</ui:repeat>


						<ui:repeat var="oneDayData"
							value="#{DailyReportRegistrationStatusIndividualBean.weeklyReportDataResultList}"
							varStatus="status">

							<p:row>
								<!-- <tr style="background-color: #{oneDayData.username eq '' ? '#d63c33' : '' };"> -->
								<p:column rowspan="#{oneDayData.activities.size() + 1   }">
									<h:outputText value="#{oneDayData.activityDate}"
										style="display: block; background-color: #{oneDayData.activityDate.contains('Sat') or oneDayData.activityDate.contains('Sun') or oneDayData.activityDate.contains(')-') ? '#d63c33' : '' };" />
								</p:column>
								<p:column rowspan="#{oneDayData.activities.size() + 1   }">
									<h:outputText
										value="#{oneDayData.totalHour lt (oneDayData.workinghour-0.01) and !oneDayData.activityDate.contains('Sat') and !oneDayData.activityDate.contains('Sun') and !oneDayData.activityDate.contains(')-')  and oneDayData.leavestatus ne 'Full Leave'  ? 'NG' : 
										oneDayData.activityDate.contains('S*') and oneDayData.activityDate.contains(')-') or oneDayData.totalHour lt 0.1 or oneDayData.leavestatus eq 'Full Leave' ? '-':'OK' }"
										style="display: block; color: #{oneDayData.totalHour lt (oneDayData.workinghour-0.01)  and !oneDayData.activityDate.contains('Sat') and !oneDayData.activityDate.contains('Sun')  and !oneDayData.activityDate.contains(')-') and  oneDayData.leavestatus ne 'Full Leave'? 'red' : '' };
										background-color: #{oneDayData.totalHour lt (oneDayData.workinghour-0.01) and !oneDayData.activityDate.contains('Sat') and !oneDayData.activityDate.contains('Sun') and !oneDayData.activityDate.contains(')-') and oneDayData.leavestatus ne 'Full Leave' ? 'yellow' :
										oneDayData.activityDate.contains('Sat') and oneDayData.activityDate.contains('Sun') and oneDayData.activityDate.contains(')-') or oneDayData.totalHour lt 0.1 or oneDayData.leavestatus eq 'Full Leave' ? '' : 
										!oneDayData.activityDate.contains('Sat') and !oneDayData.activityDate.contains('Sun') and !oneDayData.activityDate.contains(')-') and oneDayData.totalHour gt (oneDayData.workinghour-0.01)  ? '' : ''};" />

								</p:column>

								<ui:repeat var="activities" value="#{oneDayData.activities}">

									<p:row>

										<p:column>
											<h:outputText
												value="#{activities.projectID eq null ? '-' : activities.projectID}" />
										</p:column>
										<p:column>
											<h:outputText
												value="#{activities.projectName eq null ? '-' : activities.projectName}" />
										</p:column>
										
										<p:column>
											<h:outputText value="#{activities.hour}" />
										</p:column>


									</p:row>

								</ui:repeat>


								<p:column rendered="#{oneDayData.activities eq null}">
									<h:outputText value="-" />
								</p:column>
								<p:column rendered="#{oneDayData.activities eq null}">
									<h:outputText value="-" />
								</p:column>
								
								<p:column rendered="#{oneDayData.activities eq null}">
									<h:outputText value="0.00" />
								</p:column>

							</p:row>

						</ui:repeat>



					</p:panelGrid>
				</div>

			</h:form>



			<script type="text/javascript">
				history.pushState(null, null, document.URL);
				window.addEventListener('popstate', function() {
					history.pushState(null, null, document.URL);
				});
				function disableF5(e) {
					if ((e.which || e.keyCode) == 116
							|| (e.which || e.keyCode) == 82) {
						e.preventDefault();
						e.stopPropagation();
					}
				};
				$(document).bind("load", disableF5);
			</script>
			<style>
.ui-widget-header {
	border: 1px solid #327e04;
	background: #63b175;
	color: #FFFF;
}
</style>
		</h:body>
	</ui:define>
</ui:composition>
